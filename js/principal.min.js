function painel(a){table_painel=$("#tblPainel").DataTable({rowClick:function(a){document.location.href=base_url},autoWidth:!1,createdRow:function(a,e,t){"ABERTO"===e[5]&&$(a).addClass("table-warning"),"FECHADO"===e[5]&&$(a).addClass("table-success"),null!==e[4]&&$(a).removeClass("table-warning")},columnDefs:[{orderable:!1,targets:[7]},{width:"10%",targets:4,render:$.fn.dataTable.render.moment("YYYY-MM-DD HH:mm:ss","DD/MM/YYYY H:mm:ss")}],language:{decimal:"",emptyTable:"Sem chamados :)",info:"Mostrando _START_ a _END_ de _TOTAL_ chamados",infoEmpty:"Mostrando 0 a 0 de 0 chamados",infoFiltered:"(filtrado de _MAX_ chamados)",infoPostFix:"",thousands:".",lengthMenu:"Mostrando _MENU_ chamados",loadingRecords:"Carregando...",processing:"Processando...",search:"Busca:",zeroRecords:"Sem resultados!",paginate:{first:"Primeiro",last:"Último",next:"Próximo",previous:"Anterior"}},ajax:base_url+"chamado/listar_chamados_painel/"+a,order:[],processing:!0,drawCallback:function(a){var e=null;$(".PopoverPainel").each(function(){e=$(this).attr("data-chamado"),$.ajax({type:"post",url:base_url+"backend/texto_ultima_interacao",data:{id_chamado:e},dataType:"json",success:a=>{$(this).popover({content:a.nome_usuario+a.texto_interacao,trigger:"focus",placement:"left",html:!0})}})})}})}function mudaFila(a){!0===enc?$("#tblPainel").DataTable().clear().ajax.url(base_url+"chamado/listar_encerrados_painel/"+a).load():$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_chamados_painel/"+a).load()}function painelEncerrados(a){!1===enc?($("#slctFila").val(0),$("#btnChamados").html('<i class="fas fa-binoculars"></i> Chamados Abertos'),$("#tituloPainel").append(" (encerrados)"),$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_encerrados_painel/"+a).load(),enc=!0):($("#slctFila").val(0),$("#btnChamados").html('<i class="fas fa-binoculars"></i> Chamados Encerrados'),$("#tituloPainel").html("Painel de chamados"),$("#tblPainel").DataTable().ajax.url(base_url+"chamado/listar_chamados_painel/"+a).load(),enc=!1)}function triagem(){table_triagem=$("#tblTriagem").DataTable({autoWidth:!1,columnDefs:[{width:"10%",targets:2,render:$.fn.dataTable.render.moment("YYYY-MM-DD HH:mm:ss","DD/MM/YYYY H:mm:ss")}],language:{decimal:"",emptyTable:"Sem chamados :)",info:"Mostrando _START_ a _END_ de _TOTAL_ chamados",infoEmpty:"Mostrando 0 a 0 de 0 chamados",infoFiltered:"(filtrado de _MAX_ chamados)",infoPostFix:"",thousands:".",lengthMenu:"Mostrando _MENU_ chamados",loadingRecords:"Carregando...",processing:"Processando...",search:"Busca:",zeroRecords:"Sem resultados!",paginate:{first:"Primeiro",last:"Último",next:"Próximo",previous:"Anterior"}},ajax:base_url+"triagem/listar_triagem/",order:[]})}function buscaPatrimonios(a,e,t,i=!1,o=!1,r=!1){var n=[];$("#divPatrimonios").empty(),$("#btnRegistrarInteracao").removeAttr("disabled"),$.ajax({url:base_url+"backend/patrimonios",data:{id_chamado:a,espera:o},type:"POST",async:!0,dataType:"json",success:function(a){a.filas.forEach(function(i){$("select[name=id_fila]").append('<option value="'+i.id_fila+'" >'+i.nome_fila+"</option>"),1==t?$("option[value="+a.id_fila+"]").prop("selected","true"):$("#slctFila option[value="+e+"]").remove()}),null!=a.patrimonios&&a.patrimonios.forEach(function(a){n.push(a.num_equipamento)});var s=0;$.ajax({type:"POST",async:!0,url:base_url+"backend/equipamentos",data:{id_chamado:g_id_chamado},dataType:"JSON",success:function(a){null!=a&&(s=1,p_equips=[,],a.equipamentos.forEach(function(a){p_equips.push([a.num_equipamento,a.desc_equipamento])}))},complete:function(){p_equips.length>1&&"ATENDIMENTO"==$("#slctTipo").val()&&($("#divPatrimonios").append("<p>Serão considerados os seguintes equipamentos para esse atendimento:</p>"),$("#divPatrimonios").append("<ul></ul>"),p_equips.forEach(function(a){$("#divPatrimonios ul").append("<li>"+a[0]+" - "+a[1]+"</li>")}))}}),n.length>0?($("#divPatrimonios").empty(),1==t?($("#divPatrimonios").prepend("<p>Marque os equipamentos que foram finalizados:</p>"),i||$("#divPatrimonios p").append(" <small><strong>(opcional)</strong></small>")):0==o?$("#divPatrimonios").prepend("<p>Marque os equipamentos que serão deixados em espera:</p>"):$("#divPatrimonios").prepend("<p>Marque os equipamentos que sairão da espera:</p>"),n.forEach(function(a){$("#divPatrimonios").append('<input class="chkPatri" type="checkbox" id="'+a+'" value="'+a+'"><label class="mr-2" for="'+a+'">&nbsp;'+a+"</label>")})):1==o?($("#divPatrimonios").prepend("<p>Não existem equipamentos em espera!</p>"),r||$("#btnRegistrarInteracao").prop("disabled","true")):6==e?($("#divPatrimonios").prepend("<p>Para este tipo de interação, altere a fila para <b>Manutenção de Hardware</b></p>"),r||$("#btnRegistrarInteracao").prop("disabled","true")):0==s&&($("#divPatrimonios").prepend("<p>Não existem equipamentos disponíveis para isso!</p>"),r||$("#btnRegistrarInteracao").prop("disabled","true"))}})}function verificaTipo(a,e){switch($("select[name=id_fila]").empty(),$("#slctTipo").val()){case"ATENDIMENTO":buscaPatrimonios(e,a,!0,!1,!1),$("#divPatrimonios").show(),$("#divFila").show(),$("#slctFila").attr("disabled",!0);break;case"ALT_FILA":buscaPatrimonios(e,a,!1,!1,!1,!0),$("#divFila").show(),$("#divPatrimonios").hide(),$("#slctFila").attr("disabled",!1);break;case"OBSERVACAO":$("#divPatrimonios").hide(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0),$("#btnRegistrarInteracao").removeAttr("disabled");break;case"INSERVIVEL":3==a?(buscaPatrimonios(e,a,!0,!0),$("#divPatrimonios").show(),$("#divFila").show(),$("#slctFila").attr("disabled",!0)):($("#divPatrimonios").show(),$("#divPatrimonios").html("Opção disponível somente na fila <strong>Manutenção de Hardware</strong><br>"),$("#btnRegistrarInteracao").prop("disabled","true"),$("#divFila").hide());break;case"ESPERA":buscaPatrimonios(e,a,!1),$("#divPatrimonios").show(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0);break;case"REM_ESPERA":buscaPatrimonios(e,a,!1,!1,!0),$("#divPatrimonios").show(),$("#divFila").hide(),$("#slctFila").attr("disabled",!0)}}function criaFormRegistro(a,e){var t='<div class="row"><div class="col"><label for="tipo">Tipo</label><select class="form-control" name="tipo" id="slctTipo" onchange="verificaTipo('+e+","+a+')"></select></div></div><div class="row" id="divFila"><div class="col"><label for="id_fila">Fila</label><select class="form-control" name="id_fila" id="slctFila"></select></div></div><div class="row mt-3"><div class="col"><div id="divPatrimonios"></div></div></div><div class="row mb-3"><div class="col"><textarea name="txtInteracao"></textarea></div></div><input type="hidden" name="id_chamado" value="'+a+'"/><input type="hidden" name="id_fila_ant" value="'+e+'"/>';return t}function precisaPatrimonio(a,e){$("#listaPatrimonios").hide(),$("#msg div[id=alerta]").remove(),$("#btnVerificaPatrimoniosTriagem").hide(),e?$("#btnVerificaPatrimoniosTriagem").show():($("#listaPatrimonios").show(),$("#txtPatrimonios").removeAttr("readonly"),$("#btnVerificaPatrimonios").show(),$("#flagPrecisaPatrimonio").val(1),clearTimeout(timeout),$("#btnAbrirChamado").removeAttr("disabled"),listaVerificada=!1,6==a&&($("#divTabelaPatrimonios").hide(),$("#listaPatrimonios").hide(),listaVerificada=!0))}async function criaTabelaPatrimonios(a,e){vetorListaOK=[];var t=[],i=[],o=[],r=[],n=[],s=[],d=[],l=[],m=[];for(var u of($('[for="listaPatrimonios"]').append('<div class="spinner-border spinner-border-sm" role="status">&nbsp;&nbsp;<span class="sr-only">Carregando...</span></div>'),a))await fetch(base_url+"backend/patrimonio?url="+e+u+"&q="+u).then(a=>a.json()).then(a=>{null!=a.descricao?(a.inservivel?(i.push(u),o.push(a.descricao),r.push(a.inservivel.id_chamado_equipamento)):(n.push(u),s.push(a.descricao)),null!=a.chamado&&(d.push(u),l.push(a.descricao),m.push(a.chamado),n.pop(),s.pop())):t.push(u)});if(t.length>0)$("#listaVerificada div").remove(),$('[for="listaPatrimonios"] .spinner-border').remove(),t.forEach(function(a){$("#msgPatr").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Patrimônio inválido: <strong>'+a+'</strong><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>')}),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").show(),$("#txtPatrimonios").focus(),$("#btnAlteraPatrimonios").hide(),$("#btnVerificaPatrimonios").show(),$("#divTabelaPatrimonios").hide();else{if($('[for="listaPatrimonios"] .spinner-border').remove(),i.length>0){$("#divTabelaInserviveis").show();for(var c=0;c<i.length;c++)$("#tblInserviveis tbody").append('<tr class="table-danger"><td>'+i[c]+"</td><td>"+o[c]+"</td><td>#"+r[c]+' <a target="_blank" href="'+base_url+"chamado/"+r[c]+'">Mais...</a></td></tr>');listaVerificada=!1,$("#btnRemovePatrimonios").show()}if(d.length>0){$("#divTabelaChamadosAbertos").show();for(c=0;c<d.length;c++)$("#tblPatrimoniosAbertos tbody").append('<tr class="table-warning"><td>'+d[c]+"</td><td>"+l[c]+"</td><td>#"+m[c]+' <a target="_blank" href="'+base_url+"chamado/"+m[c]+'"><small>Mais...</small></a></td></tr>');listaVerificada=!1,$("#btnRemovePatrimonios").show()}if(n.length>0){$("#divTabelaPatrimonios").show(),$("#btnAlteraPatrimonios").show();for(c=0;c<n.length;c++)$("#tblPatrimonios tbody").append("<tr><td>"+n[c]+"</td><td>"+s[c]+"</td></tr>"),vetorListaOK.push(n[c]);0==d.length&&(listaVerificada=!0)}}}function carregaChamado(a,e){document.title="#"+a+" - Sigat";var t=null;$("#botoesAtendimento #btnModalRegistroEntrega").remove(),$("#botoesAtendimento #baixarTermoEntrega").remove(),$("#botoesAtendimento #baixarTermoResp").remove(),$("#botoesAtendimento #baixarLaudoIns").remove(),$("#botoesAtendimento #btnModalRegistro").remove(),$("#botoesAtendimento #btnEncerrarChamado").remove(),$("#botoesAtendimento #btnModalEquipamentos").remove(),$("#botoesChamado hr").hide(),$.ajax({url:base_url+"backend/chamado",dataType:"json",async:!0,data:{id_chamado:a},success:function(i){$("input[name=fila]").val(i.nome_fila_chamado),$("input[name=data_chamado]").val(i.data_chamado),$("input[name=status]").val(i.status_chamado),$("input[name=nome_solicitante]").val(i.nome_solicitante_chamado),$("input[name=telefone]").val(i.telefone_chamado),$("input[name=nome_local]").val(i.nome_local),$("input[name=id_fila_ant]").val(i.id_fila),$("div[name=descricao]").html(UTF8.decode(i.descricao_chamado)),null==i.id_responsavel?$("select[name=id_responsavel]").empty():(t=i.id_responsavel,$("select[name=id_responsavel]").html('<option value="'+i.id_responsavel+'">'+i.nome_responsavel+"</option>")),fila_atual=i.id_fila;var o=i.entrega_chamado,r=i.status_chamado;$("#botoesAtendimento #btnModalRegistro").length||i.id_responsavel!=g_id_usuario||$("#botoesAtendimento").append('<button type="button" id="btnModalRegistro" class="btn btn-primary" data-toggle="modal" data-target="#modalRegistro" data-chamado="'+a+'"><i class="far fa-sticky-note"></i> Registrar ação</button> '),1!=e&&($("#tblPatrimonios tbody").html(""),i.patrimonios.forEach(function(e){$.ajax({url:base_url+"backend/patrimonio?url="+url+e.num_equipamento+"&q="+e.num_equipamento,dataType:"json",async:!0,success:function(i){var n=null,s=null;n="FALHA"==e.status_equipamento_chamado?"ABERTO":e.status_equipamento_chamado,s=null==e.ultima_tag_equipamento?"N/A":e.ultima_tag_equipamento,$("#tblPatrimonios tbody").append("<tr><td>"+e.num_equipamento+"</td><td>"+i.descricao+"</td><td>"+s+"</td><td>"+n+"</td></tr>"),"ENTREGA"!=e.status_equipamento_chamado&&1!=o||"ABERTO"!=r||($("#botoesAtendimento #btnModalRegistroEntrega").remove(),$("#botoesAtendimento #baixarTermoEntrega").remove(),$("#botoesAtendimento #baixarTermoResp").remove(),$("#botoesAtendimento").append('<button type="button" id="btnModalRegistroEntrega" class="btn btn-success" data-toggle="modal" data-chamado="'+a+'" data-target="#modalRegistroEntrega"><i class="fas fa-file-signature"></i> Registrar entrega</button> <a href="'+base_url+"chamado/gerar_termo/"+a+'" id="baixarTermoEntrega" role="button" class="btn btn-info"><i class="fas fa-file-download"></i> Termo de Entrega</a> <a href="'+base_url+"chamado/gerar_termo_resp/"+ +a+'" id="baixarTermoResp" role="button" class="btn btn-info"><i class="fas fa-file-download"></i> Termo de Responsabilidade</a>')),"ABERTO"!=e.status_equipamento_chamado&&"ESPERA"!=e.status_equipamento_chamado&&"FALHA"!=e.status_equipamento_chamado||t!=g_id_usuario||$("#botoesAtendimento #btnModalRegistro").length||$("#botoesAtendimento").prepend('<button type="button" id="btnModalRegistro" class="btn btn-primary" data-toggle="modal" data-target="#modalRegistro" data-chamado="'+a+'"><i class="far fa-sticky-note"></i> Registrar ação</button> ')}})})),"ABERTO"!=i.status_chamado&&($("#botoesAtendimento #btnModalRegistro").remove(),$("#botoesAtendimento #btnModalEquipamentos").remove()),g_auto_usuario>3&&"FECHADO"==i.status_chamado&&($("#btnEncerrarChamado").length||$("#botoesAtendimento").prepend('<button id="btnEncerrarChamado" onclick="encerrarChamado()" class="btn btn-success"><i class="far fa-check-circle"></i> Encerrar chamado</button>')),"ABERTO"!=i.status_chamado?($("#btnEditarChamado").hide(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").hide()):((g_auto_usuario>=3&&null!=i.id_responsavel||i.id_responsavel==g_id_usuario)&&($("#btnDesbloquearChamado").show(),$("#btnEditarChamado").show(),$("#botoesChamado hr").show()),null==i.id_responsavel&&g_auto_usuario>=3&&($("#btnEditarChamado").show(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").show()),null==i.id_responsavel&&g_auto_usuario<=2&&($("#btnBloquearChamado").show(),$("#btnEditarChamado").hide(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").show()),null==i.id_responsavel&&g_auto_usuario>=3&&($("#btnBloquearChamado").show(),$("#btnEditarChamado").show(),$("#btnDesbloquearChamado").hide(),$("#botoesChamado hr").show()),null!=i.id_responsavel&&g_auto_usuario>=3&&($("#btnBloquearChamado").hide(),$("#btnEditarChamado").show(),$("#btnDesbloquearChamado").show(),$("#botoesChamado hr").show()),g_id_usuario==i.id_responsavel&&g_auto_usuario<=2&&($("#btnBloquearChamado").hide(),$("#btnEditarChamado").show()))}})}function removeInteracao(a,e){var t=!1;$.ajax({url:base_url+"interacao/remover_interacao",type:"POST",data:{id_interacao:a},beforeSend:function(){if($("#btnDesfazer").prop("disabled","true"),$.ajax({url:base_url+"backend/interacao",type:"GET",dataType:"text",async:!1,data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario,id_interacao:a},success:function(a){"1"===a&&(t=!0)}}),t&&g_auto_usuario<=3)return $("#btnDesfazer").removeAttr("disabled"),alert("Operação não permitida!"),!1},success:function(){atualizaInteracoes(e),carregaChamado(e)}})}function atualizaInteracoes(a){$.post(base_url+"backend/interacoes",{id:a}).done(function(a){$("#interacoes").html(a)})}function verificaEntrega(){1==$("input[name=confirmaEntrega]:checked").val()?($("#divEntrega").show(),$("#divFalhaEntrega").hide(),$("#btnRegistrarEntrega").show(),$("#btnRegistrarEntrega span").html(" Registrar entrega")):($("#divEntrega").hide(),$("#divFalhaEntrega").show(),$("#btnRegistrarEntrega").show(),$("#btnRegistrarEntrega span").html(" Registrar falha de entrega"),$("#txtFalhaEntrega").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]]],height:200,lang:"pt-BR",dialogsInBody:!0,disableDragAndDrop:!0}))}function encerrarChamado(){var a=$("#btnEncerrarChamado");g_auto_usuario>=3&&confirm("Deseja realmente encerrar? Isso não poderá ser desfeito!")&&$.ajax({type:"post",url:base_url+"chamado/encerrar_chamado",data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario},beforeSend:function(){a.prop("disabled","true")},success:function(e){0!=e&&(console.log("ok"),a.removeAttr("disabled"),atualizaInteracoes(g_id_chamado),carregaChamado(g_id_chamado,!0))}})}async function criaTabelaPatrimoniosEquip(a,e){vetorListaOK=[];var t=[],i=[],o=[],r=[],n=[],s=[],d=[],l=[],m=[];for(var u of($('[for="listaPatrimoniosEquip"]').append('<div class="spinner-border spinner-border-sm" role="status">&nbsp;&nbsp;<span class="sr-only">Carregando...</span></div>'),a))await fetch(base_url+"backend/patrimonio?url="+e+u+"&q="+u).then(a=>a.json()).then(a=>{null!=a.descricao?(a.inservivel?(i.push(u),o.push(a.descricao),r.push(a.inservivel.id_chamado_equipamento)):(n.push(u),s.push(a.descricao)),null!=a.chamado&&(d.push(u),l.push(a.descricao),m.push(a.chamado),n.pop(),s.pop())):t.push(u)});if(t.length>0)$("#listaVerificadaEquip div").remove(),$('[for="listaPatrimoniosEquip"] .spinner-border').remove(),t.forEach(function(a){$("#msgPatrEquip").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Patrimônio inválido: <strong>'+a+'</strong><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>')}),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").show(),$("#txtPatrimoniosEquip").focus(),$("#btnAlteraPatrimoniosEquip").hide(),$("#btnVerificaPatrimoniosEquip").show(),$("#divTabelaPatrimoniosEquip").hide();else{if($('[for="listaPatrimoniosEquip"] .spinner-border').remove(),i.length>0){$("#divTabelaInserviveisEquip").show();for(var c=0;c<i.length;c++)$("#tblInserviveisEquip tbody").append('<tr class="table-danger"><td>'+i[c]+"</td><td>"+o[c]+"</td><td>#"+r[c]+' <a target="_blank" href="'+base_url+"chamado/"+r[c]+'">Mais...</a></td></tr>');listaVerificada=!1,$("#btnRemovePatrimoniosEquip").show()}if(d.length>0){$("#divTabelaChamadosAbertosEquip").show();for(c=0;c<d.length;c++)$("#tblEquipAbertos tbody").append('<tr class="table-warning"><td>'+d[c]+"</td><td>"+l[c]+"</td><td>#"+m[c]+' <a target="_blank" href="'+base_url+"chamado/"+m[c]+'"><small>Mais...</small></a></td></tr>');listaVerificada=!1,$("#btnRemovePatrimoniosEquip").show()}if(n.length>0){$("#divTabelaPatrimoniosEquip").show(),$("#btnAlteraPatrimoniosEquip").show();for(c=0;c<n.length;c++)$("#tblPatrimoniosEquip tbody").append("<tr><td>"+n[c]+"</td><td>"+s[c]+"</td></tr>"),vetorListaOK.push(n[c]);0==d.length&&(listaVerificada=!0)}}}function zeraEquipamentos(){vEquip=[[,]]}function carregaTriagem(a){$("div[name=descricao_triagem]").html("<p>Carregando...</p>"),document.title="Triagem #"+a+" - Sigat";$.ajax({url:base_url+"backend/triagem",dataType:"json",async:!0,data:{id_triagem:a},success:function(e){$("input[name=nome_solicitante]").val(e.triagem.nome_solicitante_triagem),$("input[name=id_triagem]").val(a),$("div[name=descricao_triagem]").html(UTF8.decode(e.triagem.descricao_triagem)),e.anexos_otrs.length>0?($("#listaAnexosOTRS").html("<thead><th>Nome do arquivo</th><th>&nbsp;</th></thead><tbody></tbody>"),e.anexos_otrs.forEach(function(a){$("#listaAnexosOTRS tbody").append("<tr><td>"+a.nome_arquivo_otrs+'</td><td><a href="'+base_url+"anexo_otrs/"+a.id_anexo_otrs+'" class="badge badge-primary"><i class="fas fa-download"></i></a> <a href="'+base_url+"anexo_otrs/"+a.id_anexo_otrs+'" class="badge badge-danger"><i class="fas fa-trash"></i></a></td></tr>')})):$("#listaAnexosOTRS").html("<tr><td>Sem anexos</td></tr>"),verificaAutoEquip()}})}async function criaTabelaPatrimoniosTriagem(a){vetorListaOK=[]}async function verificaAutoEquip(){var a=null;$("#pbEquips").css("width","0%"),$("#btnVerificaPatrimoniosTriagem").prop("disabled","true"),a=$("#chkSoSelecaoTriagem").is(":checked")?window.getSelection().toString():$("[name=descricao_triagem]").html();const e=a.match(/[1-9]\d{5}\b/g);if(null!=e){function t(a){for(var e={},t=[],i=a.length,o=0,r=0;r<i;r++){var n=a[r];1!==e[n]&&(e[n]=1,t[o++]=n)}return t}const a=t(e);for(console.log(a),out=[],percentage=100/a.length,total_percentage=0,i=0;i<a.length;i++)await $.ajax({method:"post",url:base_url+"backend/equipamento",data:{e:a[i]}}).done(function(e){null==e.descricao?out.push({"Número":a[i],"Descrição":"(sem descrição)"}):out.push({"Número":a[i],"Descrição":e.descricao})}),total_percentage+=percentage,$("#pbEquips").css("width",total_percentage+"%");$("#tblEquips").jsGrid("option","data",out),$("#btnVerificaPatrimoniosTriagem").removeAttr("disabled")}}var timeout,listaVerificada=!1;const url="https://sistemas.sorocaba.sp.gov.br/acesso_equipamento/api/patrimonio/";var toggle=0,fila_atual=null,p_equips=[,];(function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],function(e){return a(e,window,document)}):"object"==typeof exports?module.exports=function(e,t){return e||(e=window),t||(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),a(t,e,e.document)}:a(jQuery,window,document)})(function(a,e,t){a.fn.dataTable.render.moment=function(a,t,i){return 1===arguments.length?(i="en",t=a,a="YYYY-MM-DD"):2===arguments.length&&(i="en"),function(o,r,n){if(!o)return"sort"===r||"type"===r?0:o;var s=e.moment(o,a,i,!0);return s.format("sort"===r||"type"===r?"x":t)}}}),$(function(){painel(g_fila_usuario),$("#slctFila").val(g_fila_usuario),triagem();const a=window.location.search,e=new URLSearchParams(a),t=e.get("v");"triagem"==t&&$("#triagem-tab").tab("show"),$("#btnAlteraPatrimonios").hide(),$("#divTabelaPatrimonios").hide(),$("#divTabelaChamadosAbertos").hide(),$("#divTabelaInserviveis").hide(),1==listaVerificada&&$("#btnAbrirChamado").removeAttr("disabled"),$("input[name=id_usuario]").val(g_id_usuario),$("#tblEventos thead tr").clone(!0).appendTo("#tblEventos thead"),$("#tblEventos thead tr:eq(1) th").each(function(a){var e=$(this).text();$(this).html('<input type="text" placeholder="Procurar '+e+'" />'),$("input",this).on("keyup change",function(){$("#tblEventos").DataTable().column(a).search()!==this.value&&$("#tblEventos").DataTable().column(a).search(this.value).draw()})})});var enc=!1,table_painel=null;let xhr;$("#tblPainel").on("click","tbody tr",function(){var a=table_painel.row($(this)).data();document.location.href=base_url+"chamado/"+a[0]}),setInterval(function(){$("#tblPainel").DataTable().ajax.reload(null,!1)},3e4),table_triagem=null,$("#tblTriagem").on("click","tbody tr",function(){var a=table_triagem.row($(this)).data();document.location.href=base_url+"triagem/"+a[0]}),$("#modalRegistro").on("show.bs.modal",function(a){var e=$(a.relatedTarget),t=e.data("chamado"),i=$(this);i.find(".modal-body #conteudo_form").empty(),i.find(".modal-body #conteudo_form").prepend(criaFormRegistro(t,fila_atual))}),$("#modalRegistro").on("shown.bs.modal",function(a){$("#btnRegistrarInteracao").removeAttr("disabled"),$("textarea[name=txtInteracao]").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture"]]],height:200,lang:"pt-BR",dialogsInBody:!0,disableDragAndDrop:!1}),$("#slctTipo").append('<option value="ATENDIMENTO" selected>Atendimento</option><option value="OBSERVACAO">Observação</option><option value="ALT_FILA">Alteração de fila</option>'),$("#slctTipo").append('<option value="ESPERA">Deixar em espera</option>'),$("#slctTipo").append('<option value="REM_ESPERA">Remover da espera</option>'),$("#slctTipo").append('<option value="INSERVIVEL">Classificar como inservível</option>'),verificaTipo(fila_atual,g_id_chamado)}),$("#modalRegistro").on("hide.bs.modal",function(a){$("div[role=alert]").remove()}),$("#modalRegistroEntrega").on("hide.bs.modal",function(a){$(this).find("#btnRegistrarEntrega").hide()}),$("#modalRegistroEntrega").on("show.bs.modal",function(a){var e=$(a.relatedTarget),t=e.data("chamado");$(this).find(".modal-body form #conteudo_form_entrega").html('<label>A entrega foi realizada? </label><br><div class="custom-control custom-radio custom-control-inline"><input onchange="verificaEntrega()" type="radio" value="1" id="rdSim" name="confirmaEntrega" class="custom-control-input"><label class="custom-control-label" for="rdSim">Sim</label></div><div class="custom-control custom-radio custom-control-inline"><input onchange="verificaEntrega()" type="radio" value="0" id="rdNao" name="confirmaEntrega" class="custom-control-input"><label class="custom-control-label" for="rdNao">Não</label></div><div id="divFalhaEntrega" style="display: none"><div class="form-group"><label for="txtFalhaEntrega"><b>Descreva o motivo:</b></label><textarea class="form-control" id="txtFalhaEntrega" rows="3"></textarea></div></div><div id="divEntrega" style="display: none"><div class="form-group"><label for="termo"><strong>Termo de entrega assinado</strong></label><input type="file" class="form-control-file" name="termo_entrega" accept=".pdf"></div><div class="form-group"><label for="termo"><strong>Termo de responsabilidade assinado <small>(se houver)</small></strong></label><input type="file" class="form-control-file" name="termo_responsabilidade" accept=".pdf"></div><div class="form-group"><label for="nome_recebedor"><strong>Nome do recebedor</strong></label><input type="text" class="form-control" name="nome_recebedor"></div></div><input type="hidden" name="id_chamado" value="'+t+'" />')}),$("#modalEquipamentos").on("show.bs.modal",function(){$("#btnAdicionarEquipamentos").removeAttr("disabled")}),$("#modalEquipamentos").on("hidden.bs.modal",function(a){$("tblEquipamentos tbody").empty(),listaVerificada=!1}),$("#modalEquipamentos").on("show.bs.modal",function(a){listaVerificada=!1}),$("input[name=nome_solicitante]").autoComplete({source:function(a,e){try{xhr.abort()}catch(a){}xhr=$.getJSON(base_url+"backend/solicitantes",{q:a},function(a){e(a)})},minChars:2,autoFocus:!0}),$("input[name=nome_local]").autoComplete({source:function(a,e){try{xhr.abort()}catch(a){}xhr=$.getJSON(base_url+"backend/locais",{q:a},function(a){e(a)})},minChars:2});var vetorListaOK=[];$("#btnVerificaPatrimonios").click(function(){var a=$("#txtPatrimonios").val();$("[name=descricao]").val(a);var e=a.match(/[1-9]\d{5}/g);if(null!=e){for($("#msgPatr div[role=alert]").remove(),$("#txtPatrimonios").prop("readonly","true"),$("#tblPatrimonios tbody tr").remove(),$("#tblPatrimoniosAbertos tbody tr").remove(),$("#btnVerificaPatrimonios").hide(),duplicado=!1,i=0;i<e.length-1;i++)for(x=e[i],j=i+1;j<e.length;j++)if(x==e[j]){duplicado=!0;break}1==duplicado?($("#listaVerificada div").remove(),$('[for="listaPatrimonios"] .spinner-border').remove(),$("#msgPatr").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Existem patrimônios duplicados na lista!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#btnAlteraPatrimonios").hide(),$("#btnVerificaPatrimonios").show(),$("#divTabelaPatrimonios").hide()):criaTabelaPatrimonios(e,url)}}),$("#btnRemovePatrimonios").click(function(){$("#tblPatrimoniosAbertos tbody tr").remove(),$("#divTabelaChamadosAbertos").hide(),$("#tblInserviveis tbody tr").remove(),$("#divTabelaInserviveis").hide(),$("#btnRemovePatrimonios").hide(),listaVerificada=!0,$("#txtPatrimonios").val(vetorListaOK),""==$("#txtPatrimonios").val()&&($("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#btnVerificaPatrimonios").show()),vetorListaOK=[]}),$("#btnAlteraPatrimonios").click(function(){$("#tblPatrimonios tbody tr").remove(),$("#tblPatrimoniosAbertos tbody tr").remove(),$("#btnVerificaPatrimonios").show(),$("#btnAlteraPatrimonios").hide(),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#divTabelaPatrimonios").hide(),$("#divTabelaChamadosAbertos").hide(),listaVerificada=!1});var tem_anexo=0;$("#chkAnexo").on("click",function(){0==tem_anexo?($("#divAnexo").append('<input type="file" class="form-control-file" accept=".gif,.jpg,.png,.pdf,.doc,.docx,.xls,.xlsx,.odt,.ods,.jpeg,.txt" name="anexo">'),$("#chkAnexo").val(1),tem_anexo=1):($("#divAnexo input[name=anexo]").remove(),$("#chkAnexo").val(0),tem_anexo=0)}),$("#frmInteracao").on("submit",function(a){a.preventDefault();var e=base_url+"chamado/registrar_interacao",t=$("textarea[name=txtInteracao]").summernote("code"),i=$("input[name=id_chamado]").val(),o=$("input[name=id_fila_ant]").val(),r=$("select[name=tipo]").val(),n=$("select[name=id_fila]").val(),s=[];return $("input[class=chkPatri]").each(function(){$(this).is(":checked")&&s.push($(this).val())}),$.ajax({url:e,type:"POST",data:{txtInteracao:t,id_chamado:i,tipo:r,id_fila:n,id_fila_ant:o,patrimonios_atendidos:s,equipamentos_atendidos:p_equips,id_usuario:g_id_usuario},beforeSend:function(){return 0==s.length&&3==o&&"INSERVIVEL"==r||0==s.length&&("REM_ESPERA"==r||"ESPERA"==r)?($("#modalRegistro .modal-body").prepend('<div class="alert alert-warning fade show" role="alert">Selecione os equipamentos!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),!1):$("textarea[name=txtInteracao]").summernote("isEmpty")?($("#modalRegistro .modal-body").prepend('<div class="alert alert-warning fade show" role="alert">O texto não pode ficar em branco!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),!1):void $("#btnRegistrarInteracao").prop("disabled","true")},success:function(a){$("#btnRegistrarInteracao").removeAttr("disabled"),atualizaInteracoes(i),$("textarea[name=txtInteracao]").summernote("reset"),$("#modalRegistro").modal("hide"),carregaChamado(i),p_equips=[,]},error:function(a,e,t){alert(a+t),$("#btnRegistrarInteracao").removeAttr("disabled")}}),!1}),$("#frmRegistroEntrega").on("submit",function(a){a.preventDefault();const e=base_url+"interacao/registrar_entrega",t=base_url+"interacao/registrar_falha_entrega";var i=$(this)[0],o=$("input[name=id_chamado]").val(),r=$("input[name=confirmaEntrega]:checked").val();if(1==r)$.ajax({url:e,type:"POST",data:new FormData(i),contentType:!1,processData:!1,beforeSend:function(){return""==$("input[name=termo]").val()?($("#divEntrega").prepend('<div class="alert alert-warning fade show" role="alert">Está faltando o termo!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("input[name=termo]").focus(),!1):""==$("input[name=nome_recebedor]").val()?($("#divEntrega").prepend('<div class="alert alert-warning fade show" role="alert">Informe o nome do recebedor!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("input[name=nome_recebedor]").focus(),!1):void $("#btnRegistrarEntrega").prop("disabled","true")},success:function(a){a.includes("ok")?(atualizaInteracoes(o),$("#modalRegistroEntrega").modal("hide"),carregaChamado(o),$("#btnRegistrarEntrega").removeAttr("disabled")):($("#divEntrega").prepend('<div class="alert alert-warning fade show" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+a+"</div>"),$("#btnRegistrarEntrega").removeAttr("disabled"))}});else{var n=$("#txtFalhaEntrega").summernote("code");$.ajax({url:t,type:"POST",data:{descr_falha:n,id_chamado:o},beforeSend:function(){if($("#txtFalhaEntrega").summernote("isEmpty"))return $("#divFalhaEntrega").prepend('<div class="alert alert-warning fade show" role="alert">Preencha a descrição!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),!1;$("#btnRegistrarEntrega").prop("disabled","true")},success:function(){atualizaInteracoes(o),$("#modalRegistroEntrega").modal("hide"),carregaChamado(o),$("#btnRegistrarEntrega").removeAttr("disabled")},error:function(){atualizaInteracoes(o),$("#modalRegistroEntrega").modal("hide"),carregaChamado(o),$("#btnRegistrarEntrega").removeAttr("disabled")}})}});var bloqueado=!1
;$("#btnBloquearChamado").on("click",function(a){a.preventDefault(),$.ajax({type:"POST",url:base_url+"backend/atualiza_responsavel",data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario,tipo:"b"},beforeSend:function(){$("#btnBloquearChamado").prop("disabled","true"),$.ajax({type:"GET",async:!0,url:base_url+"backend/chamado",data:{id_chamado:g_id_chamado},dataType:"JSON",complete:function(a){null!=a.id_responsavel&&($("#btnBloquearChamado").removeAttr("disabled"),$("#btnBloquearChamado").hide(),alert("Chamado já está bloqueado por "+a.nome_responsavel),carregaChamado(g_id_chamado,!0),bloqueado=!0)}})},success:function(){$("#btnBloquearChamado").removeAttr("disabled"),carregaChamado(g_id_chamado,!0)}})}),$("#btnDesbloquearChamado").on("click",function(a){a.preventDefault(),$.ajax({type:"POST",url:base_url+"backend/atualiza_responsavel",data:{id_chamado:g_id_chamado,id_usuario:g_id_usuario,tipo:"d"},beforeSend:function(){$("#btnDesbloquearChamado").prop("disabled","true")},success:function(a){0==a?($("#btnDesbloquearChamado").removeAttr("disabled"),$("#btnDesbloquearChamado").hide(),carregaChamado(g_id_chamado,!0)):alert("Operação não permitida: o chamado está fechado!")}})}),$("#btnEditarChamado").on("click",function(a){a.preventDefault(),$("#btnBloquearChamado").hide(),$("#btnDesbloquearChamado").hide(),$("#btnEditarChamado").hide(),$.ajax({url:base_url+"backend/chamado",dataType:"json",data:{id_chamado:g_id_chamado},success:function(a){g_auto_usuario>=3&&($("#frmEditarChamado select[name=id_responsavel]").removeAttr("disabled"),$("#frmEditarChamado select[name=id_responsavel]").html(""),$.ajax({url:base_url+"backend/usuarios",dataType:"json",type:"post",success:function(a){$("#frmEditarChamado select[name=id_responsavel]").append("<option></option>"),a.forEach(function(a){$("#frmEditarChamado select[name=id_responsavel]").append('<option value="'+a.id_usuario+'">'+a.nome_usuario+"</option>")})}})),a.id_responsavel==g_id_usuario||g_auto_usuario>=3?($("#frmEditarChamado input[name=nome_solicitante]").removeAttr("disabled"),$("#frmEditarChamado input[name=telefone]").removeAttr("disabled"),$("#frmEditarChamado input[name=nome_local]").removeAttr("disabled"),$("#frmEditarChamado button[type=submit]").removeAttr("hidden"),$("#frmEditarChamado button[type=submit]").removeAttr("disabled"),$("#frmEditarChamado #btnCancelarEdicao").removeAttr("hidden")):(alert("Chamado bloqueado!"),$("#btnEditarChamado").show())}})}),$("#btnCancelarEdicao").on("click",function(a){carregaChamado(g_id_chamado,!0),a.preventDefault(),$("#frmEditarChamado input[name=nome_solicitante]").prop("disabled","true"),$("#frmEditarChamado input[name=telefone]").prop("disabled","true"),$("#frmEditarChamado input[name=nome_local]").prop("disabled","true"),$("#frmEditarChamado button[type=submit]").prop("hidden","true"),$("#frmEditarChamado select[name=id_responsavel]").attr("disabled","true"),$("#frmEditarChamado #btnEditarChamado").show(),$(this).prop("hidden","true")}),$("#frmEditarChamado").on("submit",function(a){a.preventDefault()}).validate({rules:{nome_solicitante:"required",nome_local:"required",telefone:{required:!0,digits:!0,minlength:3}},messages:{nome_solicitante:"Campo obrigatório!",nome_local:"Campo obrigatório!",telefone:{required:"Campo obrigatório!",digits:"Somente dígitos (0-9)!",minlength:"Mínimo 3 dígitos!"}},submitHandler:function(a){var e=base_url+"chamado/alterar_chamado",t=new FormData(a);$.ajax({url:e,type:"POST",data:t,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var a=!1;if($("#frmEditarChamado input[type=submit]").prop("disabled","true"),$.ajax({url:base_url+"backend/chamado",dataType:"json",data:{id_chamado:g_id_chamado},success:function(e){(e.status_chamado="FECHADO")&&(a=!0)}}),a)return alert("Operação não permitida: chamado fechado!"),!1},success:function(a){carregaChamado(g_id_chamado,!0),atualizaInteracoes(g_id_chamado),$("#frmEditarChamado #alerta").prepend(a),setTimeout(function(){$("#msg_sucesso").alert("close")},2500),$("#frmEditarChamado input[name=nome_solicitante]").prop("disabled","true"),$("#frmEditarChamado select[name=id_responsavel]").prop("disabled","true"),$("#frmEditarChamado input[name=telefone]").prop("disabled","true"),$("#frmEditarChamado input[name=nome_local]").prop("disabled","true"),$("#frmEditarChamado button[type=submit]").prop("hidden","true"),$("#frmEditarChamado #btnEditarChamado").show(),$("#frmEditarChamado #btnCancelarEdicao").prop("hidden","true")},error:function(a,e,t){alert(t)}})}}),$("#btnVerificaPatrimoniosEquip").click(function(){var a=$("#txtPatrimoniosEquip").val(),e=a.match(/[1-9]\d{5}/g);if(null!=e){for($("#msgPatrEquip div[role=alert]").remove(),$("#txtPatrimoniosEquip").prop("readonly","true"),$("#tblPatrimoniosEquip tbody tr").remove(),$("#tblEquipAbertos tbody tr").remove(),$("#tblInserviveisEquip tbody tr").remove(),$("#btnVerificaPatrimoniosEquip").hide(),duplicado=!1,i=0;i<e.length-1;i++)for(x=e[i],j=i+1;j<e.length;j++)if(x==e[j]){duplicado=!0;break}1==duplicado?($('[for="listaPatrimoniosEquip"] .spinner-border').remove(),$("#msgPatrEquip").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Existem patrimônios duplicados na lista!<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#btnAlteraPatrimoniosEquip").hide(),$("#btnVerificaPatrimoniosEquip").show(),$("#divTabelaPatrimoniosEquip").hide()):criaTabelaPatrimoniosEquip(e,url)}}),$("#btnRemovePatrimoniosEquip").click(function(){$("#tblPatrimoniosAbertosEquip tbody tr").remove(),$("#divTabelaChamadosAbertosEquip").hide(),$("#tblInserviveisEquip tbody tr").remove(),$("#divTabelaInserviveisEquip").hide(),$("#btnRemovePatrimoniosEquip").hide(),$("#txtPatrimoniosEquip").val(vetorListaOK),""==$("#txtPatrimoniosEquip").val()&&($("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#btnVerificaPatrimoniosEquip").show()),vetorListaOK=[]}),$("#btnAlteraPatrimoniosEquip").click(function(){$("#tblEquipamentos tbody tr").remove(),$("#tblPatrimoniosAbertosEquip tbody tr").remove(),$("#btnVerificaPatrimoniosEquip").show(),$("#btnAlteraPatrimoniosEquip").hide(),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#divTabelaPatrimoniosEquip").hide(),$("#divTabelaChamadosAbertosEquip").hide(),listaVerificada=!1});var vEquip=[[,]];$("#btnAdcEquip").on("click",function(){$("#msgEquip div[id=alerta]").remove(),""!=$("#txtNumSerieEquip").val()&&""!=$("#txtDescEquip").val()&&(vEquip.push([$("#txtNumSerieEquip").val(),$("#txtDescEquip").val().toUpperCase()]),$("#tblEquipamentos tbody").append("<tr><td>"+$("#txtNumSerieEquip").val()+"</td><td>"+$("#txtDescEquip").val().toUpperCase()+"</td></tr>"),$("#txtNumSerieEquip").val(""),$("#txtDescEquip").val(""))}),$("#btnLimpaEquip").on("click",function(){$("#msgEquip div[id=alerta]").remove(),$("#tblEquipamentos tbody").empty(),zeraEquipamentos()}),$("#frmEquipamentos").on("submit",function(a){a.preventDefault();var e=new FormData($("#frmEquipamentos")[0]);if(vEquip.length>0){var t=JSON.stringify(vEquip);e.append("json_equip",t)}$.ajax({url:base_url+"interacao/adicionar_equipamentos",type:"POST",data:e,contentType:!1,cache:!1,processData:!1,beforeSend:function(){return $("#btnAdicionarEquipamentos").attr("disabled","true"),0==listaVerificada&&$("#chkEquipamentos").is(":unchecked")?($("#btnAdicionarEquipamentos").removeAttr("disabled"),$("#msgPatrEquip div[id=alerta]").remove(),$("#msgPatrEquip").append('<div id="alerta" class="alert alert-warning alert-dismissible">'),$("#alerta").append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>É necessário verificar a lista de patrimônios!'),$("#btnVerificaPatrimoniosEquip").focus(),$("#btnAdicionarEquipamentos").removeAttr("disabled"),!1):$("#chkEquipamentos").is(":checked")&&0==vEquip.length?($("#msgEquip div[id=alerta]").remove(),$("#msgEquip").append('<div id="alerta" class="alert alert-warning alert-dismissible">'),$("#alerta").append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Adicione pelo menos 1 equipamento!'),$("#btnAdicionarEquipamentos").removeAttr("disabled"),!1):void 0},success:function(){$("#modalEquipamentos").modal("hide"),zeraEquipamentos(),atualizaInteracoes(g_id_chamado),carregaChamado(g_id_chamado),listaVerificada=!1,$("#btnAdicionarEquipamentos").removeAttr("disabled"),$("#frmEquipamentos").trigger("reset"),$("#tblEquipamentos tbody").empty(),$("#txtPatrimoniosEquip").removeAttr("readonly"),$("#txtPatrimoniosEquip").focus(),$("#btnAlteraPatrimoniosEquip").hide(),$("#btnVerificaPatrimoniosEquip").show(),$("#divTabelaPatrimoniosEquip").hide(),$("#listaEquipamentos").hide()},complete:function(){}})});var autorizacoes=[{Name:"Técnico",Id:"2"},{Name:"Administrador",Id:"3"},{Name:"Master",Id:"4"}],estados=[{Name:"ATIVO",Id:"ATIVO"},{Name:"INATIVO",Id:"INATIVO"}],opcoes_fila=[{Name:"SIM",Id:"1"},{Name:"NÃO",Id:"0"}],filas=[{id_fila:"0",nome_fila:"Todos"}];$.ajax({url:base_url+"backend/filas",dataType:"json",complete:a=>{Array.prototype.push.apply(filas,a.responseJSON),$("#usuarios-grid").jsGrid({fields:[{name:"nome_usuario",type:"text",validate:"required",title:"Nome"},{name:"login_usuario",type:"text",validate:"required",title:"Login"},{name:"data_usuario",type:"text",readOnly:!0,title:"Data de criação"},{name:"status_usuario",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situação"},{name:"autorizacao_usuario",type:"select",items:autorizacoes,textField:"Name",valueField:"Id",title:"Autorização"},{name:"fila_usuario",type:"select",items:filas,textField:"nome_fila",valueField:"id_fila",title:"Fila preferencial"},{name:"alteracao_usuario",type:"text",readOnly:!0,title:"Última alteração"},{type:"control",deleteButton:!1}]})}}),$("#usuarios-grid").jsGrid({width:"100%",height:"auto",autoload:!0,inserting:!0,editing:!0,sorting:!0,paging:!0,filtering:!1,loadMessage:"Carregando...",noDataContent:"(vazio)",controller:{loadData:function(){return $.ajax({url:base_url+"usuario/listar_usuarios",dataType:"json"})},updateItem:function(a){return $.ajax({type:"POST",url:base_url+"usuario/atualizar_usuario",data:a,dataType:"json"})},insertItem:function(a){return $.ajax({type:"POST",url:base_url+"usuario/inserir_usuario",data:a,dataType:"json"})}},fields:[{name:"nome_usuario",type:"text",validate:"required",title:"Nome"},{name:"login_usuario",type:"text",validate:"required",title:"Login"},{name:"data_usuario",type:"text",readOnly:!0,title:"Data de criação"},{name:"status_usuario",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situação"},{name:"autorizacao_usuario",type:"select",items:autorizacoes,textField:"Name",valueField:"Id",title:"Autorização"},{name:"alteracao_usuario",type:"text",readOnly:!0,title:"Última alteração"},{type:"control",deleteButton:!1}]}),$("#filas-grid").jsGrid({width:"100%",height:"auto",autoload:!0,inserting:!1,editing:!1,sorting:!0,paging:!0,filtering:!1,loadMessage:"Carregando...",noDataContent:"(vazio)",controller:{loadData:function(){return $.ajax({url:base_url+"admin/listar_filas/1",dataType:"json"})},updateItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/atualizar_fila",data:a,dataType:"json"})},insertItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/inserir_fila",data:a,dataType:"json"})}},fields:[{name:"nome_fila",type:"text",validate:"required",title:"Nome"},{name:"status_fila",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situação"}]}),$("#filas-avulsas-grid").jsGrid({width:"100%",height:"auto",autoload:!0,inserting:!0,editing:!0,sorting:!0,paging:!0,filtering:!1,loadMessage:"Carregando...",noDataContent:"(vazio)",controller:{loadData:function(){return $.ajax({url:base_url+"admin/listar_filas/0",dataType:"json"})},updateItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/atualizar_fila",data:a,dataType:"json"})},insertItem:function(a){return $.ajax({type:"POST",url:base_url+"admin/inserir_fila",data:a,dataType:"json"})}},fields:[{name:"nome_fila",type:"text",validate:"required",title:"Nome"},{name:"status_fila",type:"select",items:estados,textField:"Name",valueField:"Id",title:"Situação"},{type:"control",deleteButton:!1}]}),$("#tblEventos").DataTable({autoWidth:!0,columnDefs:[{width:"10%",targets:3,render:$.fn.dataTable.render.moment("YYYY-MM-DD HH:mm:ss","DD/MM/YYYY H:mm:ss")},{width:"10%",targets:0},{width:"40%",targets:2}],orderCellsTop:!1,fixedHeader:!0,language:{decimal:"",emptyTable:"(vazio)",info:"Mostrando _START_ a _END_ de _TOTAL_ eventos",infoEmpty:"Mostrando 0 a 0 de 0 eventos",infoFiltered:"(filtrado de _MAX_ eventos)",infoPostFix:"",thousands:".",lengthMenu:"Mostrando _MENU_ eventos",loadingRecords:"Carregando...",processing:"Processando...",search:"Busca:",zeroRecords:"Sem resultados!",paginate:{first:"Primeiro",last:"Último",next:"Próximo",previous:"Anterior"}},ajax:base_url+"admin/listar_eventos/",order:[[0,"desc"]]}),setInterval(function(){$("#tblEventos").DataTable().ajax.reload(null,!1)},15e3),UTF8={encode:function(a){for(var e,t=-1,i=(a=a.split("")).length,o=String.fromCharCode;++t<i;a[t]=(e=a[t].charCodeAt(0))>=127?o(192|e>>>6)+o(128|63&e):a[t]);return a.join("")},decode:function(a){for(var e,t,i=-1,o=(a=a.split("")).length,r=String.fromCharCode,n="charCodeAt";++i<o;128&(e=a[i][n](0))&&(a[i]=192==(252&e)&&128==(192&(t=a[i+1][n](0)))?r(((3&e)<<6)+(63&t)):r(128),a[++i]=""));return a.join("")}},$("#btnInsManualPatrimoniosTriagem").on("click",function(){$("#divInsercaoManual").show()}),$("#btnAddNovoEquip").on("click",function(a){a.preventDefault(),$("#divInsercaoManual").show()}),$("#btnVerificaPatrimoniosTriagem").click(async function(){}),$("#btnRemovePatrimoniosTriagem").click(function(){$("#tblPatrimoniosAbertos tbody tr").remove(),$("#divTabelaChamadosAbertos").hide(),$("#tblInserviveis tbody tr").remove(),$("#divTabelaInserviveis").hide(),$("#btnRemovePatrimoniosTriagem").hide(),$("#btnVerificaPatrimoniosTriagem").removeAttr("disabled"),vetorListaOK=[]}),$("#btnAlteraPatrimoniosTriagem").click(function(){$("#tblPatrimoniosAbertos tbody tr").remove(),$("#btnVerificaPatrimoniosTriagem").removeAttr("disabled"),$("#btnAlteraPatrimoniosEquip").hide(),$("#divTabelaPatrimonios").hide(),$("#divTabelaChamadosAbertos").hide(),listaVerificada=!1}),$("#frmDevolveChamado").on("submit",function(a){a.preventDefault();var e=$(this).find("#txtDescDevo").val();""!==e&&confirm("Deseja realmente devolver esse ticket? Isso não poderá ser desfeito!")&&$.ajax({url:base_url+"chamado/devolver_chamado",async:!0,method:"post",data:{id_triagem:g_id_chamado,desc_devo:e},beforeSend:function(){$(this).find("submit").prop("disabled","true")},success:function(a){document.location.href=base_url+"painel?v=triagem"}})}),$("#tblEquips").jsGrid({width:"100%",autoload:!1,editing:!0,inserting:!0,confirmDeleting:!1,fields:[{name:"Número",type:"text",width:50},{name:"Descrição",type:"text",width:50},{type:"control",deleteButton:!0}]}),$("#frmImportarChamado").on("submit",function(a){a.preventDefault()}).validate({rules:{nome_solicitante:"required",nome_local:"required",telefone:{required:!0,digits:!0,minlength:3},listaPatrimonios:{required:!0,minlength:6},descricao:{required:!0,minlength:10,normalizer:function(a){return $.trim(a)}},id_fila:{required:!0}},messages:{nome_solicitante:"Campo obrigatório!",nome_local:"Campo obrigatório!",telefone:{required:"Campo obrigatório!",digits:"Somente dígitos (0-9)!",minlength:"Mínimo 3 dígitos!"},descricao:{required:"Campo obrigatório!",minlength:"Descrição insuficiente!",maxlength:"Tamanha máximo excedido!"},id_fila:{required:"Selecione uma fila válida!"}},submitHandler:function(a){var e=base_url+"chamado/importar_chamado",t=new FormData(a);return t.append("listaPatrimonios",vetorListaOK),$.ajax({url:e,type:"POST",data:t,contentType:!1,cache:!1,processData:!1,beforeSend:function(){if(0==listaVerificada)return $("#msg div[id=alerta]").remove(),$("#msg").append('<div id="alerta" class="alert alert-warning alert-dismissible">'),$("#alerta").append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>É necessário verificar a lista de patrimônios!'),$("#btnVerificaPatrimoniosTriagem").focus(),targetOffset=$("#msg").offset().top,$("html, body").animate({scrollTop:targetOffset-100},200),!1;$("#btnImportarChamado").prop("disabled","true")},success:function(a){listaVerificada=!1,0==a.includes("Local")?($("#divTriagem").html(""),$("#msg div[id=alerta]").remove(),$("#msg").append(a)):(a.includes("Local")&&($("input[name=nome_local").focus(),$("#listaLocais").popover({content:"Local inválido!",trigger:"focus"}),$("#listaLocais").popover("toggle")),listaVerificada=!0,$("#btnImportarChamado").removeAttr("disabled")),$("#btnImportarChamado").removeAttr("disabled"),0==listaVerificada&&($("#tblPatrimonios tr").remove(),$("#btnVerificaPatrimoniosTriagem").show(),$("#btnAlteraPatrimonios").hide(),$("#txtPatrimonios").removeAttr("readonly"),$("#txtPatrimonios").focus(),$("#divTabelaPatrimonios").hide()),a=null},error:function(a,e,t){$("#msg").prepend('<div id="alerta" class="alert alert-danger alert-dismissible">'),$("#alerta").append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+t),targetOffset=$("#msg").offset().top,$("html, body").animate({scrollTop:targetOffset-100},200),$("#btnImportarChamado").removeAttr("disabled")}}),!1}});